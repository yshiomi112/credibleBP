{% extends "global/Page.html" %}
{% block title %}ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ—ãƒ©ãƒ³ã®è¨­è¨ˆï¼ˆ{{ round_label }}ï¼‰{% endblock %}
{% block content %}


<style>
/* æ—¢å­˜ã¨æ–°UIã®çµ±åˆã‚¹ã‚¿ã‚¤ãƒ« */
.slider-container {
  display: flex;
  justify-content: space-between;
  gap: 40px;
  margin-bottom: 30px;
}
.slider-box { flex: 1; }
.color-slider {
  -webkit-appearance: none;
  width: 100%;
  height: 20px;
  border-radius: 10px;
  background: linear-gradient(to right, #ff6666 50%, #66ccff 50%);
  outline: none;
  margin-top: 10px;
}
.color-slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 36px;
  height: 36px;
  border-radius: 50%;
  background: white;
  border: 2px solid gray;
  cursor: pointer;
  margin-top: -8px;
}
.color-slider.disabled::-webkit-slider-thumb { display: none; }
.prob-value {
  display: inline-block;
  padding: 4px 8px;
  font-size: 1.5em;
  font-weight: bold;
  border: 2px solid #ccc;
  border-radius: 6px;
  margin-right: 5px;
}
.message-line { margin-bottom: 10px; line-height: 1.8; }
.distribution-container {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 40px;
  margin-top: 20px;
}
#countdown-timer-box {
  background-color: #fff4cc;
  border-radius: 10px;
  padding: 12px 20px;
  font-size: 1.2em;
  font-weight: bold;
  color: #444;
  text-align: center;
  margin: 20px 0;
}
#timeout-warning {
  display: none;
  background: #ffe0e0;
  border-radius: 10px;
  padding: 10px 20px;
  margin: 20px 0;
  font-weight: bold;
  text-align: center;
  color: #800000;
}
.box-wrapper {
  background-color: #fdfdfd;
  border: 1px solid #888;
  border-radius: 12px;
  padding: 20px;
  margin: 20px 0;
}
.box-heading {
  font-size: 1.2em;
  font-weight: bold;
  margin-bottom: 12px;
}
.box-wrapper.light {
  border-color: #ddd;  /* â† éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªæ ã¯è–„ã„ã‚°ãƒ¬ãƒ¼ã« */
}

</style>

<!-- ğŸ”¸ã‚¿ã‚¤ãƒãƒ¼ã¨è­¦å‘Šè¡¨ç¤º -->
{# â–¼â–¼â–¼ ã‚¿ã‚¤ãƒãƒ¼è¡¨ç¤ºï¼šæœ¬ç•ªãƒ©ã‚¦ãƒ³ãƒ‰ã ã‘ â–¼â–¼â–¼ #}
{% if player.round_number not in [1, 2] %}
  <div id="countdown-timer-box">
    âŒ›ï¸ ã“ã®ãƒšãƒ¼ã‚¸ã§ã®æ®‹ã‚Šæ™‚é–“ <strong id="time-left">1:30</strong>
  </div>
  <div id="timeout-warning">
    â° æ™‚é–“ãŒçµŒéã—ã¾ã—ãŸã€‚ãªã‚‹ã¹ãæ—©ãé¸æŠã—ã¦ãã ã•ã„ã€‚
  </div>
{% endif %}

{% if player.round_number in [1, 2] %}
  <p style="color:red; font-weight:bold;">â€»ã“ã‚Œã¯ç·´ç¿’ãƒ©ã‚¦ãƒ³ãƒ‰ã§ã™ã€‚ç·´ç¿’ãƒ©ã‚¦ãƒ³ãƒ‰ã®çµæœã¯å ±é…¬ã«å½±éŸ¿ã‚’ä¸ãˆã¾ã›ã‚“ã€‚</p>
{% endif %}

<p>ä¸‹ã®æ å†…ã®ï¼’ã¤ã®ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚’æ“ä½œã—ã¦ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ—ãƒ©ãƒ³ã‚’è¨­è¨ˆã—ã¦ãã ã•ã„ã€‚</p>
<p>ã“ã“ã§è¨­è¨ˆã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ—ãƒ©ãƒ³ã¯ã€å—ä¿¡è€…ã«å…¬é–‹ã•ã‚Œã¾ã™ã€‚</p>


<form method="post">
  <!-- ğŸ”¸ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ—ãƒ©ãƒ³æ  -->
  <div class="box-wrapper">
    <h3 class="box-heading">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ—ãƒ©ãƒ³</h3>
    <div class="slider-container">
      <!-- èµ¤ç‰ -->
      <div class="slider-box">
        <p><strong><span style="color:#ff6666">èµ¤ç‰</span>ãŒå¼•ã‹ã‚ŒãŸå ´åˆï¼š</strong></p>
        <input type="range" min="0" max="100" value="50" id="sliderR" class="color-slider">
        <p class="message-line">
          <span class="prob-value" id="valueR">--</span>ï¼…ã®ç¢ºç‡ã§ã€Œ<strong style="color:#ff6666">èµ¤è‰²</strong>ã€ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡
        </p>
        <p class="message-line">
          <span class="prob-value" id="valueRB">--</span>ï¼…ã®ç¢ºç‡ã§ã€Œ<strong style="color:#66ccff">é’è‰²</strong>ã€ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡
        </p>
      </div>

      <!-- é’ç‰ -->
      <div class="slider-box">
        <p><strong><span style="color:#66ccff">é’ç‰</span>ãŒå¼•ã‹ã‚ŒãŸå ´åˆï¼š</strong></p>
        <input type="range" min="0" max="100" value="50" id="sliderB" class="color-slider">
        <p class="message-line">
          <span class="prob-value" id="valueB">--</span>ï¼…ã®ç¢ºç‡ã§ã€Œ<strong style="color:#ff6666">èµ¤è‰²</strong>ã€ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡
        </p>
        <p class="message-line">
          <span class="prob-value" id="valueBB">--</span>ï¼…ã®ç¢ºç‡ã§ã€Œ<strong style="color:#66ccff">é’è‰²</strong>ã€ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡
        </p>
      </div>
    </div>
  </div>

  <p>ä¸‹ã®æ å†…ã«ã¯ã€ã‚ãªãŸãŒè¨­è¨ˆã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ—ãƒ©ãƒ³ã‹ã‚‰ï¼ˆè‡ªå‹•çš„ã«ï¼‰è¨ˆç®—ã•ã‚Œã‚‹ã€å…¨ä½“ã§ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ç¢ºç‡ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚</p>
  <p>ã“ã®å…¨ä½“ã§ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ç¢ºç‡ã‚‚ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ—ãƒ©ãƒ³ã¨å…±ã«å—ä¿¡è€…ã«å…¬é–‹ã•ã‚Œã¾ã™ã€‚</p>

  <!-- ğŸ”¸å‘¨è¾ºç¢ºç‡æ  -->
  <div class="box-wrapper light">
    <h3 class="box-heading">å…¨ä½“ã§ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ç¢ºç‡</h3>
    <input type="range" min="0" max="100" value="50" id="sliderMarginalCombined" class="color-slider disabled" disabled>
    <div class="distribution-container">
      <p class="message-line">
        ã€Œ<strong style="color:#ff6666">èµ¤è‰²</strong>ã€ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒé€ä¿¡ã•ã‚Œã‚‹ç¢ºç‡ã¯
        <span class="prob-value" id="valueTotalR">--</span>ï¼…
      </p>
      <p class="message-line">
        ã€Œ<strong style="color:#66ccff">é’è‰²</strong>ã€ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒé€ä¿¡ã•ã‚Œã‚‹ç¢ºç‡ã¯
        <span class="prob-value" id="valueTotalB">--</span>ï¼…
      </p>
    </div>
  </div>

  <!-- hidden -->
  <input type="hidden" name="pi_r_given_R" id="inputR">
  <input type="hidden" name="pi_r_given_B" id="inputB">

  <p>è¨­è¨ˆãŒå®Œäº†ã—ãŸã‚‰ã€Œå…¬é–‹ã™ã‚‹ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚</p>

  <button class="btn btn-primary">å…¬é–‹ã™ã‚‹</button>
</form>

<script>
function updateSliderColor(slider) {
  const val = slider.value;
  slider.style.background = `linear-gradient(to right, #ff6666 ${val}%, #66ccff ${val}%)`;
}

function update() {
  const sR = document.getElementById("sliderR");
  const sB = document.getElementById("sliderB");
  const rR = parseInt(sR.value, 10);
  const rB = parseInt(sB.value, 10);

  document.getElementById("valueR").textContent  = rR;
  document.getElementById("valueRB").textContent = 100 - rR;
  document.getElementById("valueB").textContent  = rB;
  document.getElementById("valueBB").textContent = 100 - rB;

  updateSliderColor(sR);
  updateSliderColor(sB);

  const priorR = 0.3, priorB = 0.7;
  const total_r = (rR / 100) * priorR + (rB / 100) * priorB;
  const valueTotalR = Math.round(total_r * 100);
  const valueTotalB = 100 - valueTotalR;

  document.getElementById("valueTotalR").textContent = valueTotalR;
  document.getElementById("valueTotalB").textContent = valueTotalB;

  const sliderCombined = document.getElementById("sliderMarginalCombined");
  sliderCombined.value = valueTotalR;
  updateSliderColor(sliderCombined);
}

const sliderR = document.getElementById("sliderR");
const sliderB = document.getElementById("sliderB");
sliderR.addEventListener("input", update);
sliderB.addEventListener("input", update);

// åˆæœŸè¡¨ç¤ºã®è‰²
updateSliderColor(sliderR);
updateSliderColor(sliderB);
updateSliderColor(document.getElementById("sliderMarginalCombined"));

// hidden ã‚»ãƒƒãƒˆ
document.querySelector("form").addEventListener("submit", () => {
  document.getElementById("inputR").value = (sliderR.value / 100).toFixed(3);
  document.getElementById("inputB").value = (sliderB.value / 100).toFixed(3);
});

// ã‚¿ã‚¤ãƒãƒ¼æ©Ÿèƒ½
let secondsLeft = 90;
function updateTimeDisplay() {
  const min = Math.floor(secondsLeft / 60);
  const sec = secondsLeft % 60;
  document.getElementById('time-left').textContent = `${min}:${sec.toString().padStart(2, '0')}`;
}
updateTimeDisplay();
const timer = setInterval(() => {
  secondsLeft -= 1;
  updateTimeDisplay();
  if (secondsLeft <= 0) {
    clearInterval(timer);
    document.getElementById("timeout-warning").style.display = "block";
  }
}, 1000);
</script>
{% endblock %}
